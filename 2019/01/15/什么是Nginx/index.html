<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="YogaCheng">
  <!-- Open Graph Data -->
  <meta property="og:title" content="Nginx学习笔记"/>
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="Yoga&#39;s Blog"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://yoursite.com"/>
  
    <link rel="alternate" href="/atom.xml" title="Yoga&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>Yoga's Blog</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">Nginx学习笔记</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="/522676621@qq.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By YogaCheng</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2019-01-15</span>
            <span class="time">21:17:03</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/Nginx/">Nginx</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/Nginx/">#Nginx</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h2 id="什么是Nginx"><a href="#什么是Nginx" class="headerlink" title="什么是Nginx"></a>什么是Nginx</h2><hr>
<p>是一个高性能的反向代理服务器<br>正向代理代理的是客户端<br>反向代理代理的是服务端<br><a id="more"></a></p>
<h2 id="Apache、Tomcat、Nginx"><a href="#Apache、Tomcat、Nginx" class="headerlink" title="Apache、Tomcat、Nginx"></a>Apache、Tomcat、Nginx</h2><hr>
<p>静态web服务器<br>jsp/servlet服务器 tomcat</p>
<h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><hr>
<ol>
<li>下载tar包</li>
<li>tar -zxvf nginx.tar.gz</li>
<li>./configure [–prefix]</li>
<li>make &amp;&amp; make install</li>
</ol>
<h2 id="启动和停止"><a href="#启动和停止" class="headerlink" title="启动和停止"></a>启动和停止</h2><hr>
<ol>
<li>sbin/nginx</li>
<li>./nginx -s stop</li>
</ol>
<h2 id="虚拟主机配置"><a href="#虚拟主机配置" class="headerlink" title="虚拟主机配置"></a>虚拟主机配置</h2><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">   listen    <span class="number">80</span>;</span><br><span class="line">   server_name localhost;</span><br><span class="line">   #charset koi8-r;</span><br><span class="line">   #access_log logs/host.access.log main;</span><br><span class="line">   location / &#123;</span><br><span class="line">     root  html;</span><br><span class="line">     index index.html index.htm;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="基于端口号的虚拟主机"><a href="#基于端口号的虚拟主机" class="headerlink" title="基于端口号的虚拟主机"></a>基于端口号的虚拟主机</h2><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">   listen    <span class="number">8080</span>;</span><br><span class="line">   server_name  localhost;</span><br><span class="line">   location / &#123;</span><br><span class="line">     root html;</span><br><span class="line">     index index.html;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="基于域名的虚拟主机"><a href="#基于域名的虚拟主机" class="headerlink" title="基于域名的虚拟主机"></a>基于域名的虚拟主机</h2><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">   listen    <span class="number">80</span>;</span><br><span class="line">   server_name  www.gupaoedu.com;</span><br><span class="line">   location / &#123;</span><br><span class="line">     root html;</span><br><span class="line">     index index.html;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> server &#123;</span><br><span class="line">   listen    <span class="number">80</span>;</span><br><span class="line">   server_name bbs.gupaoedu.com;</span><br><span class="line">   location / &#123;</span><br><span class="line">    root  html;</span><br><span class="line">    index bbs.html;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> server &#123;</span><br><span class="line">   listen    <span class="number">80</span>;</span><br><span class="line">   server_name ask.gupaoedu.com;</span><br><span class="line">   location / &#123;</span><br><span class="line">     root html;</span><br><span class="line">     index ask.html;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="location"><a href="#location" class="headerlink" title="location"></a>location</h2><hr>
<h3 id="配置语法"><a href="#配置语法" class="headerlink" title="配置语法"></a>配置语法</h3><hr>
<p>location [= | ~* | ^~ ] /uri/ {…}</p>
<h3 id="配置规则"><a href="#配置规则" class="headerlink" title="配置规则"></a>配置规则</h3><hr>
<p>location = /uri 精准匹配<br>location ^~ /uri 前缀匹配<br>location ~ /uri<br>location / 通用匹配</p>
<h3 id="规则的优先级"><a href="#规则的优先级" class="headerlink" title="规则的优先级"></a>规则的优先级</h3><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> location = /</span><br><span class="line"><span class="number">2</span> location = /index</span><br><span class="line"><span class="number">3</span> location ^~ /article/</span><br><span class="line"><span class="number">4</span> location ^~ /article/files/</span><br><span class="line"><span class="number">5</span> location ~ \.(gif|png|js|css)$</span><br><span class="line"><span class="number">6</span> location /</span><br><span class="line">http:<span class="comment">//192.168.11.154/ </span></span><br><span class="line">http:<span class="comment">//192.168.11.154/index -&gt;2</span></span><br><span class="line">http:<span class="comment">//192.168.11.154/article/files/1.txt -&gt;4</span></span><br><span class="line">http:<span class="comment">//192.168.11.154/mic.png -&gt;5</span></span><br></pre></td></tr></table></figure>
<ol>
<li>精准匹配是优先级最高</li>
<li>普通匹配（最长的匹配）</li>
<li>正则匹配</li>
</ol>
<h3 id="实际使用建议"><a href="#实际使用建议" class="headerlink" title="实际使用建议"></a>实际使用建议</h3><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location =/ &#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">location / &#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">location ~* \.(gif|....)$&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="nginx反向代理"><a href="#nginx反向代理" class="headerlink" title="nginx反向代理"></a>nginx反向代理</h2><hr>
<p>nginx反向代理的指令不需要新增额外的模块，默认自带proxy_pass指令，只需要修改配置文件就可以实现反向代<br>理。<br>proxy_pass 既可以是ip地址，也可以是域名，同时还可以指定端口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"> listen <span class="number">80</span>;</span><br><span class="line"> server_name localhost;</span><br><span class="line"> location / &#123;</span><br><span class="line">   proxy_pass http:<span class="comment">//192.168.11.161:8080;</span></span><br><span class="line">   proxy_set_header Host $host;</span><br><span class="line">   proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><hr>
<ol>
<li>启动tomcat服务器</li>
<li><p>nginx配置的统一维护，将Nginx.conf文件的内容修改成如下配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">img</span><br><span class="line">server &#123;</span><br><span class="line"> listen <span class="number">80</span>;</span><br><span class="line"> server_name localhost;</span><br><span class="line"> location / &#123;</span><br><span class="line">   proxy_pass http:<span class="comment">//192.168.11.161:8080;</span></span><br><span class="line">   proxy_set_header Host $host;</span><br><span class="line">   proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">\<span class="number">3</span>. 在extra文件夹中添加proxy_demo.conf</span><br><span class="line">server&#123;</span><br><span class="line">listen <span class="number">80</span>;</span><br><span class="line">server_name localhost;</span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass http:<span class="comment">//192.168.11.154:8080;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>./nginx -s reload 重新加载</p>
</li>
</ol>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><hr>
<p>网络负载均衡的大致原理是利用一定的分配策略将网络负载平衡地分摊到网络集群的各个操作单元上，使得单个重<br>负载任务能够分担到多个单元上并行处理，使得大量并发访问或数据流量分担到多个单元上分别处理，从而减少用<br>户的等待响应时间<br>upstream<br>是Nginx的HTTP Upstream模块，这个模块通过一个简单的调度算法来实现客户端IP到后端服务器的负载均衡</p>
<ol>
<li>Upstream<br>语法： server address [paramters]</li>
<li>负载均衡策略或者算法<br>轮询算法（默认）， 如果后端服务器宕机以后，会自动踢出<br>ip_hash 根据请求的ip地址进行hash<br>权重轮询</li>
</ol>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

